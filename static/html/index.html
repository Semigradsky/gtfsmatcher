<!doctype html>

<html lang="en" ng-app="gtfsmatch">
<head>
<meta charset="utf-8">
<title>GTFS Matcher</title>
<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.2/angular.min.js"></script>

<script src="gtfsmatcher.js"></script>
<link rel="stylesheet" type="text/css" href="main.css" />
<link rel="stylesheet"
	href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
	integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
	crossorigin="" />
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
	integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
	crossorigin=""></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-polylinedecorator/1.1.0/leaflet.polylineDecorator.min.js"></script>	
</head>

<body>
	<div ng-controller="StopsController" class="row">
		<div class="col compact">
			<div ng-init="activeTab = 'stops'">
				<span ng-click="activeTab = 'stops'" >Stops</span>
				<span ng-click="activeTab = 'routes'">Routes</span>
				<span ng-click="activeTab = 'changes'">Changes</span>
				<div>Name pattern: <input style="width: 80%" ng-model="namePattern"></input></div>
			</div>
			<div class="tab" ng-if="activeTab == 'stops'">
				<div class="scroll-wrapper">
					<div id="stop{{stop.id}}" ng-repeat="stop in stops" >
						<div 
							ng-bind="stop.name" 
							ng-class="{matched: stop.matched && stop.code == stop.matched.tags.ref}"
							ng-click="selectStop(stop);" ></div>
						<div class="details" ng-if="selected == stop.id">
							<div><a ng-repeat="route in getStopRoutes(stop)" ng-click="showTrip(getTripForStop(stop, route), route);"> {{route.name}} </a></div>
							<div ng-if="stop.matched">
								<div>Matched object tags:</div>
								<table>
									<tr ng-repeat="(k,v) in stop.matched.tags">
										<td ng-bind="k"></td>
										<td><input ng-model="v" ng-change="editTags(stop, k, v);"></td>
									</tr>
								</table>
								<button 
									ng-hide="stop.matched.tags.ref == stop.code" 
									ng-click="stopSetRef(stop);" >Set ref</button>
								<button 
									ng-hide="stop.matched.tags.name == stop.name" 
									ng-click="stopSetName(stop);" >Set name</button>	
							</div>
							<div ng-hide="stop.matched">
								<div>Candidates</div>
								<div ng-repeat="candidate in stop.candidates">
									<button ng-click="assignMatched(stop, candidate);">assign</button>
									<span ng-bind="candidate.tags.ref"></span>
									<span ng-bind="candidate.tags.name"></span>
								</div>
							</div>
							<button ng-click="resetMatch(stop);">Reassign</button>
							<button ng-click="createMatched(stop);" ng-hide="stop.matched">Add to OSM</button>
							<button ng-click="moveMatched(stop);" ng-if="stop.matched" ng-disabled="reassignPositionMode">
								{{reassignPositionMode ? 'Click on map in new position' : 'Move OSM object'}}
							</button>
						</div>
					</div>
				</div>
			</div>
			<div class="tab" ng-if="activeTab == 'routes'">
				<div class="scroll-wrapper">
					<div ng-repeat="route in routes">
						<div ng-bind="route.name" ng-click="open = !open"></div>
						<div ng-repeat="trip in route.trips" ng-show="open" class="trip" >
							<div ng-click="showTrip(trip, route);">Trip {{$index + 1}}</div>
							<a ng-repeat="stopid in trip.stops" 
								ng-click="selectStopInRoute(stopid, route);" 
								ng-bind="stopid"
								ng-class="{matched: isStopMatched(stopid)}"></a>
						</div>
					</div>
				</div>
			</div>
			<div class="tab" ng-if="activeTab == 'changes'">
				<div ng-repeat="obj in changes.create">
					<div>Create {{obj.tags.ref}} {{obj.tags.name}}</div>
				</div>
				<div ng-repeat="obj in changes.update">
					<div>Update {{obj.tags.ref}} {{obj.tags.name}}</div>
				</div>
				<button ng-click="getChangesetXML()">get xml</button>
				<button ng-click="openJOSM()">Open in JOSM</button>
				<div>{{changesetXML}}</div>
			</div>
		</div>
		<div id="mapid" class="wide"></div>
	</div>
</body>
</html>